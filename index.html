<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y-Tools</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSIjMjhhNzQ1Ii8+CiAgPHBhdGggZD0iTTggOGgzdjZoNlY4aDN2MTZoLTN2LTZIOXY2SDhWOHoiIGZpbGw9IndoaXRlIi8+CiAgPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMi41IiBmaWxsPSIjZmZkNzAwIi8+Cjwvc3ZnPgo=">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        :root{--primary-green:#28a745;--light-green-bg:#e9f5ee;--border-color:#d8e6de;--text-color:#333;--secondary-text-color:#555;--page-bg:#f8f9fa;--content-bg:#fff;--card-bg:#fff;--input-bg:transparent;--separator-color:#c9d9d1;--currency-name-bg:#c1e5d4;--currency-name-color:#1a593b;--flag-bg:#f0f0f0;--flag-border:#ddd;--animation-speed:0.2s;--theme-transition:0.3s}

        [data-theme="dark"]{--primary-green:#10b981;--light-green-bg:#374151;--border-color:#4b5563;--text-color:#f3f4f6;--secondary-text-color:#d1d5db;--page-bg:#111827;--content-bg:#1f2937;--card-bg:#374151;--input-bg:#374151;--separator-color:#6b7280;--currency-name-bg:#047857;--currency-name-color:#ecfdf5;--flag-bg:#4b5563;--flag-border:#6b7280}
        *,*::before,*::after{transition:background-color var(--theme-transition),color var(--theme-transition),border-color var(--theme-transition),box-shadow var(--theme-transition)!important}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei","Helvetica Neue",Helvetica,Arial,sans-serif;background-color:var(--page-bg);margin:0;padding:2rem;display:flex;justify-content:center;color:var(--text-color)}.container{display:flex;gap:2rem;width:100%;max-width:1100px}.sidebar{flex:0 0 120px;display:flex;flex-direction:column;align-items:center;gap:1.5rem}.sidebar-item{background-color:var(--card-bg);border-radius:1rem;padding:1rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.5rem;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,.05);text-align:center;font-size:.8rem;width:100%;transition:box-shadow var(--animation-speed)}.sidebar-item.active{background:linear-gradient(135deg,#4ad295,#2ab67b);color:#fff;cursor:default}.sidebar-item:not(.active):hover{box-shadow:0 6px 12px rgba(0,0,0,.08)}.sidebar-item.active svg{color:#fff}.content{flex:1;background-color:var(--content-bg);border-radius:1rem;padding:2rem;box-shadow:0 4px 12px rgba(0,0,0,.08);position:relative;overflow:hidden;height:calc(100vh - 8rem);display:flex;flex-direction:column}.page{position:absolute;top:2rem;left:2rem;right:2rem;bottom:2rem;opacity:0;transition:opacity var(--animation-speed) ease-in-out;pointer-events:none;display:flex;flex-direction:column;min-height:calc(100vh - 12rem)}.page.active{opacity:1;position:relative;top:auto;left:auto;right:auto;bottom:auto;pointer-events:auto}h1,h2{margin:0 0 .5rem;font-weight:700;flex-shrink:0}h1{font-size:2rem}h2{font-size:1.5rem}.subtitle{margin:0 0 1.5rem;color:var(--secondary-text-color);flex-shrink:0}.update-info{background-color:var(--light-green-bg);border:1px solid var(--border-color);padding:.75rem 1rem;border-radius:.5rem;margin-bottom:1.5rem;font-size:.9rem;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.update-info .refresh-btn{background-color:var(--primary-green);color:#fff;border:none;padding:.25rem .75rem;border-radius:.25rem;cursor:pointer;font-size:.85rem;font-family:inherit;transition:background-color var(--animation-speed)}.update-info .refresh-btn:hover{opacity:.9}.update-info .refresh-btn:disabled{background-color:#999;cursor:not-allowed}.rates-grid-wrapper{padding-right:10px;margin-right:-10px}.rates-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem}.rate-row{display:flex;align-items:center;background-color:var(--light-green-bg);border-radius:.5rem;padding:.75rem;border:1px solid transparent;transition:transform 0.2s ease-in-out,box-shadow var(--animation-speed) ease,border-color .2s}.rate-row:focus-within{border-color:var(--primary-green)}.rate-row.sortable-ghost{background:#d4f0e2;opacity:.7}.rate-row.sortable-chosen{box-shadow:0 8px 20px rgba(0,0,0,.15);border:1px solid var(--border-color);transform:scale(1.02)}.drag-handle{cursor:grab;color:#b0c9bd;margin-right:.75rem;flex-shrink:0}.drag-handle:active{cursor:grabbing}.currency-code{font-weight:700;width:50px;flex-shrink:0;color:var(--secondary-text-color);margin-left:2px}.white-separator{color:#fff;margin:0 .1rem;font-size:.8rem}.currency-flag{width:18px;height:13px;background-size:cover;background-position:center;border-radius:2px;margin:0;display:inline-block;vertical-align:middle;flex-shrink:0;background-color:var(--flag-bg);border:1px solid var(--flag-border);overflow:hidden;cursor:pointer}.currency-flag.error{background-image:none!important;background-color:var(--flag-bg);position:relative;opacity:.6}.currency-flag.error::after{content:'ğŸ³';font-size:10px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--secondary-text-color)}

        [data-theme="dark"] .currency-flag{filter:brightness(1.1) contrast(0.95)}.separator{color:var(--separator-color);margin:0 .2rem}
        .theme-switcher{position:fixed;top:2rem;right:2rem;background:var(--card-bg);border:1px solid var(--border-color);border-radius:.75rem;padding:.5rem;box-shadow:0 4px 12px rgba(0,0,0,.1);display:flex;align-items:center;gap:.5rem;z-index:1000}.theme-btn{background:none;border:none;padding:.5rem;border-radius:.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--secondary-text-color);transition:all .2s ease;width:40px;height:40px}.theme-btn:hover{background:var(--light-green-bg);color:var(--text-color)}.theme-btn.active{background:var(--primary-green);color:#fff}.theme-btn svg{width:20px;height:20px}
        .currency-instructions{position:fixed;top:10rem;right:2rem;background:var(--card-bg);border:1px solid var(--border-color);border-radius:.5rem;padding:1rem;max-width:280px;box-shadow:0 4px 12px rgba(0,0,0,.1);z-index:999}.currency-instructions h2{font-size:.9rem;margin:0 0 .5rem;color:var(--text-color)}.currency-instructions p{margin:.25rem 0;font-size:.8rem;line-height:1.4;color:var(--secondary-text-color)}.currency-value{flex-grow:1;border:none;background:transparent;font-size:1rem;font-family:'Menlo','Monaco','Consolas',monospace;padding:.25rem;outline:0;width:100%;cursor:text;color:var(--text-color)}.currency-name{background-color:var(--currency-name-bg);color:var(--currency-name-color);font-weight:500;padding:.25rem .75rem;border-radius:.25rem;font-size:.8rem;white-space:nowrap}.instructions{margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color);flex-shrink:0}.instructions p{font-size:.9rem;color:var(--secondary-text-color);line-height:1.6}.copy-notification{position:fixed;left:2rem;bottom:2rem;background-color:var(--primary-green);color:#fff;padding:.75rem 1.5rem;border-radius:.5rem;box-shadow:0 4px 10px rgba(0,0,0,.1);font-size:.9rem;z-index:1000;opacity:0;transform:translateX(-120%);transition:opacity var(--animation-speed) ease,transform var(--animation-speed) ease}.copy-notification.show{opacity:1;transform:translateX(0)}.json-container{display:flex;flex-grow:1;gap:.75rem;min-height:calc(100vh - 28rem)}.json-pane{flex:1;display:flex;flex-direction:column;background-color:var(--light-green-bg);border-radius:.5rem;overflow:hidden;min-height:calc(100vh - 30rem)}.json-pane textarea{width:100%;height:100%;flex-grow:1;padding:.75rem;margin:0;border:none;background:transparent;resize:none;outline:none;font-family:'Menlo','Monaco','Consolas',monospace;font-size:1rem;color:var(--text-color);line-height:1.6;overflow-y:auto;min-height:calc(100vh - 32rem)}.json-pane pre{width:100%;height:100%;flex-grow:1;padding:.75rem;margin:0;border:none;background:transparent;resize:none;outline:none;font-family:'Menlo','Monaco','Consolas',monospace;font-size:1rem;color:var(--text-color);line-height:1.6;overflow-y:auto}.json-pane pre{white-space:pre-wrap;word-break:break-all}.json-pane pre.error{color:#d9534f;font-weight:700}

.json-tree{overflow-y:auto;height:100%;min-height:calc(100vh - 32rem);padding:.75rem;font-family:'Menlo','Monaco','Consolas',monospace;font-size:1rem;line-height:1.6;color:var(--text-color)}.json-tree.error{color:#d9534f;font-weight:700}.json-node{margin:0}.json-toggle{cursor:pointer;display:inline-block;width:12px;height:12px;margin-right:4px;text-align:center;background:var(--light-green-bg);border:1px solid var(--border-color);border-radius:3px;font-size:10px;line-height:10px;user-select:none;transition:transform .2s ease}.json-toggle:hover{background:var(--primary-green);color:#fff}.json-toggle.collapsed{transform:rotate(-90deg)}.json-toggle.empty{opacity:.3;cursor:default}.json-toggle.empty:hover{background:var(--light-green-bg);color:var(--text-color)}.json-key{color:#0451a5;font-weight:500}.json-string{color:#0a8043}.json-number{color:#098658}.json-boolean{color:#e36209}.json-null{color:#a626a4}.json-bracket{font-weight:bold;cursor:pointer}.json-bracket.level-0{color:#e60000}.json-bracket.level-1{color:#f57c00}.json-bracket.level-2{color:#388e3c}.json-bracket.level-3{color:#1976d2}.json-bracket.level-4{color:#7b1fa2}.json-bracket.level-5{color:#c2185b}.json-bracket:hover{opacity:.7}.json-count{color:var(--secondary-text-color);font-size:.85em;margin-left:4px}.json-collapsed{display:none}.json-ellipsis{color:var(--secondary-text-color);font-style:italic;cursor:pointer}.json-ellipsis:hover{color:var(--primary-green)}

[data-theme="dark"] .json-key{color:#9cdcfe}[data-theme="dark"] .json-string{color:#ce9178}[data-theme="dark"] .json-number{color:#b5cea8}[data-theme="dark"] .json-boolean{color:#569cd6}[data-theme="dark"] .json-null{color:#c586c0}[data-theme="dark"] .json-bracket.level-0{color:#ff6b6b}[data-theme="dark"] .json-bracket.level-1{color:#ffa726}[data-theme="dark"] .json-bracket.level-2{color:#66bb6a}[data-theme="dark"] .json-bracket.level-3{color:#42a5f5}[data-theme="dark"] .json-bracket.level-4{color:#ab47bc}[data-theme="dark"] .json-bracket.level-5{color:#ec407a}
.food-container{display:flex;justify-content:center;align-items:center;flex-grow:1;padding:2rem;min-height:calc(100vh - 20rem)}.wheel-container{position:relative;display:flex;flex-direction:column;align-items:center;gap:2rem}.wheel-pointer{position:absolute;top:-15px;left:50%;transform:translateX(-50%);font-size:2rem;color:var(--primary-green);z-index:10;text-shadow:0 2px 4px rgba(0,0,0,.3)}#wheel-canvas {
    border-radius: 50%;
    box-shadow: 0 8px 32px rgba(0,0,0,.15);
    border: 4px solid var(--primary-green);
    will-change: transform;
    transform-origin: center center;
    /* ç§»é™¤CSS transitionï¼Œä½¿ç”¨JavaScriptåŠ¨ç”» */
}

.mode-toggle{position:absolute;top:1rem;right:1rem;background:var(--card-bg);border:1px solid var(--border-color);border-radius:.5rem;padding:.5rem;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:all .2s ease;z-index:100}.mode-toggle:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.mode-toggle svg{width:20px;height:20px;color:var(--secondary-text-color);transition:color .2s}.mode-toggle:hover svg{color:var(--text-color)}

.box-container{display:none;flex-direction:column;align-items:center;gap:2rem;width:100%}

.mystery-box{width:200px;height:200px;background:linear-gradient(135deg,#2c3e50,#34495e);border-radius:1rem;border:3px solid var(--primary-green);display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;cursor:pointer;transition:all .3s ease;box-shadow:0 8px 32px rgba(0,0,0,.15)}.mystery-box:hover{animation:hoverShake .6s ease-in-out infinite;box-shadow:0 12px 40px rgba(0,0,0,.2)}.mystery-box::before{content:'ğŸ';font-size:4rem;margin-bottom:.5rem}.mystery-box .box-text{color:#fff;font-size:1.2rem;font-weight:600;text-align:center}.mystery-box.opening{animation:boxShake .5s ease-in-out}

@keyframes boxShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}

@keyframes hoverShake{0%,100%{transform:translateX(0) rotate(0deg)}25%{transform:translateX(-3px) rotate(-2deg)}75%{transform:translateX(3px) rotate(2deg)}}
.box-viewer{position:relative;width:100%;max-width:800px;height:200px;background:linear-gradient(135deg,#1a1a2e,#16213e);border-radius:1rem;overflow:hidden;border:2px solid #4CAF50;opacity:0;transform:scale(.9);transition:all .5s ease}.box-viewer.active{opacity:1;transform:scale(1)}.box-track {
    display: flex;
    align-items: center;
    height: 100%;
    will-change: transform;
    transform: translateX(0);
    /* ç§»é™¤CSS transitionï¼Œä½¿ç”¨JavaScriptåŠ¨ç”» */
}.box-item{flex-shrink:0;width:120px;height:120px;margin:0 10px;border-radius:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden}.box-item img{width:60px;height:60px;object-fit:cover;border-radius:.25rem}.box-item .item-name{font-size:.7rem;color:#fff;margin-top:.25rem;text-align:center;font-weight:500}.box-selector{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:140px;height:140px;border:3px solid #fff;border-radius:.5rem;box-shadow:0 0 20px rgba(255,255,255,.5);pointer-events:none;z-index:10}.rarity-common{background:linear-gradient(135deg,#5dade2,#85c1e9)}.rarity-uncommon{background:linear-gradient(135deg,#bb8fce,#d2b4de)}.rarity-rare{background:linear-gradient(135deg,#f1948a,#fadbd8)}.rarity-epic{background:linear-gradient(135deg,#f8c471,#fdeaa7)}.rarity-legendary{background:linear-gradient(135deg,#f39c12,#f7dc6f);position:relative}.rarity-legendary::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,rgba(255,215,0,.3) 25%,transparent 25%,transparent 75%,rgba(255,215,0,.3) 75%),linear-gradient(45deg,rgba(255,215,0,.3) 25%,transparent 25%,transparent 75%,rgba(255,215,0,.3) 75%);background-size:10px 10px;background-position:0 0,5px 5px;animation:shine 2s infinite linear}

@keyframes shine{0%{background-position:0 0,5px 5px}100%{background-position:20px 20px,25px 25px}}

.spin-button{background:linear-gradient(135deg,var(--primary-green),#20c063);color:#fff;border:none;padding:1rem 2rem;border-radius:2rem;font-size:1.1rem;font-weight:600;cursor:pointer;box-shadow:0 4px 12px rgba(40,167,69,.3);transition:all .3s ease;font-family:inherit}.spin-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(40,167,69,.4)}.spin-button:active{transform:translateY(0)}.spin-button:disabled{background:#999;cursor:not-allowed;transform:none}

/* ç»“æœå¼¹çª—æ ·å¼ */
.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6);backdrop-filter:blur(5px)}.modal.show{display:flex;align-items:center;justify-content:center}.modal-content{background:var(--content-bg);padding:2rem;border-radius:1rem;text-align:center;position:relative;max-width:400px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:modalShow .3s ease-out}.close-btn{position:absolute;top:1rem;right:1.5rem;color:var(--secondary-text-color);font-size:2rem;font-weight:bold;cursor:pointer;line-height:1;transition:color .2s}.close-btn:hover{color:var(--text-color)}.result-content img{width:150px;height:150px;object-fit:cover;border-radius:1rem;margin-bottom:1rem;box-shadow:0 4px 12px rgba(0,0,0,.2)}.result-content h2{margin:0 0 .5rem;color:var(--text-color);font-size:1.5rem}.result-content p{margin:0;color:var(--secondary-text-color);font-size:1rem}

@keyframes modalShow{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
@media (max-width:768px){.wheel-container{gap:1.5rem}#wheel-canvas{width:300px!important;height:300px!important}.wheel-pointer{font-size:1.5rem;top:-12px}.spin-button{padding:.8rem 1.5rem;font-size:1rem}.modal-content{margin:1rem;padding:1.5rem}.result-content img{width:120px;height:120px}}

@media (max-width:900px){.rates-grid{grid-template-columns:1fr}}@media (max-width:768px){body{padding:1rem}.container{flex-direction:column}.content{padding:1rem}.page{top:1rem;left:1rem;right:1rem;bottom:1rem}.sidebar{flex-direction:row;flex:1 1 0%;justify-content:center;gap:1rem;width:100%;max-width:none;margin:0 auto}.sidebar-item{flex:1}.copy-notification{left:1rem;bottom:1rem;width:calc(100% - 2rem);text-align:center}.json-container{flex-direction:column}.theme-switcher{top:1rem;right:1rem;padding:.5rem;gap:.5rem}.theme-btn{width:36px;height:36px;padding:.5rem}.theme-btn svg{width:18px;height:18px}.currency-instructions{top:8rem;right:1rem;left:1rem;max-width:none;width:auto}}

.testfile-container{display:flex;gap:2rem;flex-grow:1;min-height:0}.testfile-form{flex:1;background-color:var(--light-green-bg);padding:2rem;border-radius:1rem;display:flex;flex-direction:column;gap:1.5rem}.testfile-info{flex:1;background-color:var(--light-green-bg);padding:2rem;border-radius:1rem}.form-group{display:flex;flex-direction:column;gap:.5rem}.form-group label{font-weight:600;color:var(--text-color);font-size:1rem}.size-input-group{display:flex;gap:.5rem}.size-input{flex:1;padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:.5rem;background:var(--input-bg);color:var(--text-color);font-size:1rem;font-family:'Menlo','Monaco','Consolas',monospace;transition:border-color var(--animation-speed)}.size-input:focus{outline:none;border-color:var(--primary-green)}.unit-select{padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:.5rem;background:var(--input-bg);color:var(--text-color);font-size:1rem;cursor:pointer;transition:border-color var(--animation-speed)}.unit-select:focus{outline:none;border-color:var(--primary-green)}.extension-input{padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:.5rem;background:var(--input-bg);color:var(--text-color);font-size:1rem;transition:border-color var(--animation-speed)}.extension-input:focus{outline:none;border-color:var(--primary-green)}.input-hint{font-size:.85rem;color:var(--secondary-text-color)}.generate-btn{background:linear-gradient(135deg,var(--primary-green),#20c063);color:#fff;border:none;padding:1rem 2rem;border-radius:.5rem;font-size:1rem;font-weight:600;cursor:pointer;box-shadow:0 4px 12px rgba(40,167,69,.3);transition:all .3s ease;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:.5rem}.generate-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(40,167,69,.4)}.generate-btn:active{transform:translateY(0)}.generate-btn:disabled{background:#999;cursor:not-allowed;transform:none;box-shadow:none}.generate-btn svg{width:20px;height:20px}.progress-section{display:flex;flex-direction:column;gap:1rem;margin-top:1rem}.progress-bar{width:100%;height:10px;background-color:var(--border-color);border-radius:5rem;overflow:hidden}.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary-green),#20c063);width:0%;transition:width .2s ease;border-radius:5rem}.progress-text{font-size:.9rem;color:var(--secondary-text-color);text-align:center}.testfile-info h2{margin:0 0 1rem;font-size:1.25rem}.testfile-info h3{margin:1.5rem 0 .75rem;font-size:1.1rem}.testfile-info ul{margin:0;padding-left:1.5rem;line-height:1.8}.testfile-info li{color:var(--text-color);margin-bottom:.5rem}.testfile-info strong{color:var(--primary-green)}.size-examples{margin-top:1.5rem}.example-tags{display:flex;flex-wrap:wrap;gap:.5rem}.example-tag{background-color:var(--card-bg);border:1px solid var(--border-color);padding:.5rem 1rem;border-radius:2rem;font-size:.9rem;cursor:pointer;transition:all .2s ease;color:var(--text-color)}.example-tag:hover{background:var(--primary-green);color:#fff;border-color:var(--primary-green);transform:translateY(-2px)}@media (max-width:900px){.testfile-container{flex-direction:column;max-height:none}}@media (max-width:768px){.testfile-form,.testfile-info{padding:1.5rem}.size-input-group{flex-direction:column}}
    </style>
</head>
<body>
    <div id="copy-notification" class="copy-notification">å·²å¤åˆ¶</div>

    <!-- Theme switcher -->
    <div class="theme-switcher" id="theme-switcher">
        <button class="theme-btn" id="theme-light" title="æµ…è‰²æ¨¡å¼">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
            </svg>
        </button>
        <button class="theme-btn" id="theme-dark" title="æ·±è‰²æ¨¡å¼">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
            </svg>
        </button>
        <button class="theme-btn" id="theme-system" title="è·Ÿéšç³»ç»Ÿ">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25" />
            </svg>
        </button>
    </div>

    <!-- Instructions - Currency page only -->
    <div id="currency-instructions" class="currency-instructions" style="display:none;">
        <h2>æ±‡ç‡å·¥å…·è¯´æ˜</h2>
        <p><strong>åŠŸèƒ½è¯´æ˜:</strong> ä½¿ç”¨å…¬å¼€APIæä¾›æ•°æ®ï¼Œæ±‡ç‡å¹¶éæ¯«ç§’çº§å®æ—¶ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
        <p><strong>æ–°æ‰‹æç¤º:</strong> æ‚¨å¯è¾“å…¥ `100+50` æˆ– `10*1.1` ç­‰ç®—å¼åæŒ‰å›è½¦è¿›è¡Œè®¡ç®—ã€‚ç‚¹å‡»ä»»æ„è¾“å…¥æ¡† (æ•°å­—éƒ¨åˆ†) å¯å¤åˆ¶å½“å‰é‡‘é¢ã€‚æŒ‰ä½æ¯è¡Œæœ€å·¦ä¾§çš„å›¾æ ‡å¯æ‹–åŠ¨æ’åºã€‚</p>
    </div>

    <div class="container">
        <aside class="sidebar">
            <div id="nav-currency" class="sidebar-item active">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-3.64-2.28m3.64 2.28l-2.28 3.64" /></svg>
                <span>æ±‡ç‡æ¢ç®—</span>
            </div>
            <div id="nav-json" class="sidebar-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.25 9.75L16.5 12l-2.25 2.25m-4.5 0L7.5 12l2.25-2.25M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z" /></svg>
                <span>JSON å·¥å…·</span>
            </div>
            <div id="nav-food" class="sidebar-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg>
                <span>ä»Šå¤©åƒä»€ä¹ˆ</span>
            </div>
            <div id="nav-testfile" class="sidebar-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 10.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                <span>æµ‹è¯•æ–‡ä»¶ç”Ÿæˆ</span>
            </div>
        </aside>
        <main class="content">
            <div id="page-currency" class="page active" style="display:flex;flex-direction:column;">
                <h1 style="margin-bottom:.25rem;">æ±‡ç‡æ¢ç®—</h1>
                <p class="subtitle" style="margin-bottom:.5rem;">ç®€å•çš„æ±‡ç‡æ¢ç®—å·¥å…·ï¼Œæ±‡ç‡æ•°æ®å®šæ—¶æ›´æ–°ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
                <div class="update-info" style="margin-bottom:.75rem;">
                    <span id="update-time">æ­£åœ¨è·å–æ±‡ç‡æ•°æ®...</span>
                    <button class="refresh-btn" id="refresh-button">åˆ·æ–°æ±‡ç‡</button>
                </div>
                <div class="rates-grid-wrapper" style="flex-grow:1;overflow-y:auto;">
                    <div class="rates-grid" id="rates-container"><p>æ­£åœ¨åŠ è½½...</p></div>
                </div>
            </div>
            <div id="page-json" class="page" style="display:flex;flex-direction:column;">
                <h1>JSON æ ¼å¼åŒ–</h1>
                <p class="subtitle">ç²˜è´´JSONå­—ç¬¦ä¸²ï¼Œå·¥å…·å°†è‡ªåŠ¨æ ¼å¼åŒ–å¹¶é«˜äº®æ˜¾ç¤ºã€‚</p>
                <div class="json-container" style="flex-grow:1;min-height:0;">
                    <div class="json-pane" style="flex:1;">
                        <textarea id="json-input" placeholder="åœ¨æ­¤å¤„ç²˜è´´ JSON..."></textarea>
                    </div>
                    <div class="json-pane" style="flex:1;">
                        <div id="json-output" class="json-tree"></div>
                    </div>
                </div>
                <div class="instructions">
                    <h2>JSON å·¥å…·è¯´æ˜</h2>
                    <p><strong>æ ¼å¼åŒ–åŠŸèƒ½:</strong> å®æ—¶è§£æå’Œæ ¼å¼åŒ– JSON æ•°æ®ï¼Œæ”¯æŒè¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚</p>
                    <p><strong>æ“ä½œæç¤º:</strong> ç‚¹å‡» â–¼ æŒ‰é’®å¯æŠ˜å /å±•å¼€å¯¹è±¡å’Œæ•°ç»„ã€‚æ”¯æŒå¤šå±‚åµŒå¥—ç»“æ„ï¼Œä¾¿äºæŸ¥çœ‹å¤æ‚æ•°æ®ã€‚</p>
                </div>
            </div>
            <div id="page-food" class="page" style="display:flex;flex-direction:column;">
                <h1>ä»Šå¤©åƒä»€ä¹ˆ</h1>
                <p class="subtitle">è½¬ç›˜å†³å®šä½ çš„ä¸‹ä¸€é¤ï¼Œè§£å†³é€‰æ‹©å›°éš¾ç—‡ï¼</p>

                <!-- Mode toggle button -->
                <div class="mode-toggle" id="mode-toggle" title="åˆ‡æ¢æ¨¡å¼">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                    </svg>
                </div>

                <div class="food-container" style="flex-grow:1;min-height:0;">
                    <!-- Wheel mode -->
                    <div class="wheel-container" id="wheel-mode">
                        <div class="wheel-pointer">â–¼</div>
                        <canvas id="wheel-canvas" width="400" height="400"></canvas>
                        <button id="spin-button" class="spin-button">å¼€å§‹è½¬ç›˜</button>
                    </div>

                    <!-- Box mode -->
                    <div class="box-container" id="box-mode">
                        <!-- Mystery box state -->
                        <div class="mystery-box" id="mystery-box">
                            <div class="box-text">ç¥ç§˜å®ç®±<br>ç‚¹å‡»å¼€å¯</div>
                        </div>

                        <!-- Box viewer state -->
                        <div class="box-viewer" id="box-viewer">
                            <div class="box-selector"></div>
                            <div class="box-track" id="box-track"></div>
                        </div>

                        <button id="box-button" class="spin-button" style="display: none;">å¼€å¯å®ç®±</button>
                    </div>
                </div>
            </div>
            <div id="page-testfile" class="page" style="display:flex;flex-direction:column;">
                <h1>æµ‹è¯•æ–‡ä»¶ç”Ÿæˆ</h1>
                <p class="subtitle">ç”Ÿæˆä»»æ„å¤§å°çš„æµ‹è¯•æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•ç½‘ç»œä¼ è¾“ã€å­˜å‚¨ç­‰åœºæ™¯ã€‚</p>

                <div class="testfile-container">
                    <div class="testfile-form">
                        <div class="form-group">
                            <label for="file-size">æ–‡ä»¶å¤§å°</label>
                            <div class="size-input-group">
                                <input type="number" id="file-size" class="size-input" placeholder="10" min="0.001" step="0.001">
                                <select id="size-unit" class="unit-select">
                                    <option value="B">B (å­—èŠ‚)</option>
                                    <option value="KB">KB (åƒå­—èŠ‚)</option>
                                    <option value="MB" selected>MB (å…†å­—èŠ‚)</option>
                                    <option value="GB">GB (å‰å­—èŠ‚)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="file-extension">æ–‡ä»¶æ‰©å±•å</label>
                            <input type="text" id="file-extension" class="extension-input" value="test" placeholder="ä¾‹å¦‚: test, dat, bin">
                            <small class="input-hint">ä¸åŒ…å«ç‚¹å·ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ </small>
                        </div>

                        <button id="generate-btn" class="generate-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                            </svg>
                            ç”Ÿæˆå¹¶ä¸‹è½½æ–‡ä»¶
                        </button>

                        <div class="progress-section" id="progress-section" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <div class="progress-text" id="progress-text">å‡†å¤‡ä¸­...</div>
                        </div>
                    </div>

                    <div class="testfile-info">
                        <h2>ä½¿ç”¨è¯´æ˜</h2>
                        <ul>
                            <li><strong>æ”¯æŒå•ä½:</strong> B (å­—èŠ‚)ã€KB (åƒå­—èŠ‚)ã€MB (å…†å­—èŠ‚)ã€GB (å‰å­—èŠ‚)</li>
                            <li><strong>æœ€å¤§æ”¯æŒ:</strong> 1GB (å—æµè§ˆå™¨å†…å­˜é™åˆ¶)</li>
                            <li><strong>ç”Ÿæˆå†…å®¹:</strong> éšæœºå­—èŠ‚æ•°æ®ç»„æˆçš„æµ‹è¯•æ–‡ä»¶</li>
                            <li><strong>é€‚ç”¨åœºæ™¯:</strong> ç½‘ç»œä¼ è¾“æµ‹è¯•ã€ä¸‹è½½é€Ÿåº¦æµ‹è¯•ã€å­˜å‚¨æµ‹è¯•</li>
                        </ul>

                        <div class="size-examples">
                            <h3>å¸¸è§å¤§å°å‚è€ƒ</h3>
                            <div class="example-tags">
                                <span class="example-tag" data-size="1" data-unit="MB">1 MB</span>
                                <span class="example-tag" data-size="10" data-unit="MB">10 MB</span>
                                <span class="example-tag" data-size="50" data-unit="MB">50 MB</span>
                                <span class="example-tag" data-size="100" data-unit="MB">100 MB</span>
                                <span class="example-tag" data-size="1" data-unit="GB">1 GB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Result modal -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="result-content">
                <img id="result-image" src="" alt="">
                <h2 id="result-name"></h2>
                <p>å°±å†³å®šæ˜¯ä½ äº†ï¼</p>
            </div>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const BASE_CURRENCY = 'CNY';
        const DEFAULT_AMOUNT = 100;
        
        let currencyOrder = [
            'CNY', 'HKD', 'TWD', 'USD', 'RUB', 'VND', 'INR', 'EUR', 'JPY',
            'GBP', 'SGD', 'PHP', 'ARS', 'TRY', 'KRW', 'CHF', 'AUD', 'IDR',
            'THB', 'PKR', 'CAD', 'SAR', 'MXN', 'BDT', 'MYR'
        ];
        const currencyNames = {
            'CNY': 'äººæ°‘å¸ [ä¸­å›½ Â¥]', 'HKD': 'æ¸¯å…ƒ [ä¸­å›½é¦™æ¸¯ HK$]', 'TWD': 'å°å¸ [ä¸­å›½å°æ¹¾ NT$]', 'USD': 'ç¾å…ƒ [ç¾å›½ $]', 'RUB': 'å¢å¸ƒ [ä¿„ç½—æ–¯ â‚½]', 'VND': 'è¶Šå—ç›¾ [è¶Šå— â‚«]', 'INR': 'å¢æ¯” [å°åº¦ â‚¹]', 'EUR': 'æ¬§å…ƒ [æ¬§ç›Ÿ â‚¬]', 'JPY': 'æ—¥å…ƒ [æ—¥æœ¬ Â¥]', 'GBP': 'è‹±é•‘ [è‹±å›½ Â£]', 'SGD': 'æ–°å…ƒ [æ–°åŠ å¡ S$]', 'PHP': 'æ¯”ç´¢ [è²å¾‹å®¾ â‚±]', 'ARS': 'æ¯”ç´¢ [é˜¿æ ¹å»· $]', 'TRY': 'é‡Œæ‹‰ [åœŸè€³å…¶ â‚º]', 'KRW': 'éŸ©å…ƒ [éŸ©å›½ â‚©]', 'CHF': 'æ³•éƒ [ç‘å£« Fr]', 'AUD': 'æ¾³å…ƒ [æ¾³å¤§åˆ©äºš A$]', 'IDR': 'å°å°¼ç›¾ [å°å°¼ Rp]', 'THB': 'æ³°é“¢ [æ³°å›½ à¸¿]', 'PKR': 'å¢æ¯” [å·´åŸºæ–¯å¦ Rs]', 'CAD': 'åŠ å…ƒ [åŠ æ‹¿å¤§ C$]', 'SAR': 'é‡Œäºšå°” [æ²™ç‰¹é˜¿æ‹‰ä¼¯ SR]', 'MXN': 'æ¯”ç´¢ [å¢¨è¥¿å“¥ $]', 'BDT': 'å¡”å¡ [å­ŸåŠ æ‹‰å›½ à§³]', 'MYR': 'æ—å‰ç‰¹ [é©¬æ¥è¥¿äºš RM]',
        };

        const currencyFlags = {
            'CNY': 'cn', 'HKD': 'hk', 'TWD': 'tw', 'USD': 'us', 'RUB': 'ru',
            'VND': 'vn', 'INR': 'in', 'EUR': 'eu', 'JPY': 'jp', 'GBP': 'gb',
            'SGD': 'sg', 'PHP': 'ph', 'ARS': 'ar', 'TRY': 'tr', 'KRW': 'kr',
            'CHF': 'ch', 'AUD': 'au', 'IDR': 'id', 'THB': 'th', 'PKR': 'pk',
            'CAD': 'ca', 'SAR': 'sa', 'MXN': 'mx', 'BDT': 'bd', 'MYR': 'my'
        };

        // ç‰¹æ®Šå¤„ç†ä¸€äº›å¯èƒ½404çš„ä»£ç ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
        function getFlagUrl(code) {
            const flagCode = currencyFlags[code] || 'xx';

            // ç‰¹æ®Šæ˜ å°„ï¼šæ¬§ç›Ÿä½¿ç”¨å¾·å›½æ——å¸œä½œä¸ºä»£è¡¨
            if (flagCode === 'eu') {
                return 'https://flagcdn.com/w20/de.png';
            }

            // å¤‡ç”¨CDNåˆ—è¡¨
            const cdnOptions = [
                `https://flagcdn.com/w20/${flagCode}.png`,
                `https://countryflagsapi.com/png/${flagCode}`
            ];

            return cdnOptions[0]; // ä½¿ç”¨ç¬¬ä¸€ä¸ªä½œä¸ºä¸»è¦CDN
        }

        const ratesContainer = document.getElementById('rates-container');
        const updateTimeEl = document.getElementById('update-time');
        const refreshButton = document.getElementById('refresh-button');
        const notificationEl = document.getElementById('copy-notification');

        const navCurrency = document.getElementById('nav-currency');
        const navJson = document.getElementById('nav-json');
        const navFood = document.getElementById('nav-food');
        const navTestfile = document.getElementById('nav-testfile');
        const pageCurrency = document.getElementById('page-currency');
        const pageJson = document.getElementById('page-json');
        const pageFood = document.getElementById('page-food');
        const pageTestfile = document.getElementById('page-testfile');
        const jsonInput = document.getElementById('json-input');
        const jsonOutput = document.getElementById('json-output');

        // é£Ÿç‰©è½¬ç›˜ç›¸å…³å…ƒç´ 
        const wheelCanvas = document.getElementById('wheel-canvas');
        const spinButton = document.getElementById('spin-button');
        const resultModal = document.getElementById('result-modal');
        const resultImage = document.getElementById('result-image');
        const resultName = document.getElementById('result-name');
        const closeBtn = document.querySelector('.close-btn');

        // æµ‹è¯•æ–‡ä»¶ç”Ÿæˆç›¸å…³å…ƒç´ 
        const fileSizeInput = document.getElementById('file-size');
        const sizeUnitSelect = document.getElementById('size-unit');
        const fileExtensionInput = document.getElementById('file-extension');
        const generateBtn = document.getElementById('generate-btn');
        const progressSection = document.getElementById('progress-section');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const exampleTags = document.querySelectorAll('.example-tag');

        let exchangeRates = {}, baseCurrencyForCalc = BASE_CURRENCY, baseAmountForCalc = DEFAULT_AMOUNT, notificationTimeout;

        // é£Ÿç‰©æ•°æ® - å¸¦ç¨€æœ‰åº¦åˆ†çº§ï¼Œä½¿ç”¨é«˜è´¨é‡å›¾ç‰‡
        const foodData = [
            // è“è‰² - æ™®é€š (50%)
            { name: 'åŒ…å­', image: 'https://images.unsplash.com/photo-1548373779-e0ea9b9e65b8?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'é¥ºå­', image: 'https://images.unsplash.com/photo-1563379091339-03246963d96c?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'é¢æ¡', image: 'https://images.unsplash.com/photo-1555126634-323283e090fa?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'é¦„é¥¨', image: 'https://images.unsplash.com/photo-1551024506-0bccd828d307?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'ç²¥ç±»', image: 'https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'ç‚’é¥­', image: 'https://images.unsplash.com/photo-1512058564366-18510be2db19?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'è›‹ç‚’é¥­', image: 'https://images.unsplash.com/photo-1574484284002-952d92456975?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'ä¸‰æ˜æ²»', image: 'https://images.unsplash.com/photo-1528735602780-2552fd46c7af?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'è½»é£Ÿæ²™æ‹‰', image: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'å¥¶èŒ¶', image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'éº»è¾£çƒ«', image: 'https://images.unsplash.com/photo-1585032226651-759b368d7246?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'æ²™å¿å°åƒ', image: 'https://images.unsplash.com/photo-1596797038530-2c107229654b?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'ç›–æµ‡é¥­', image: 'https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'å’–å–±é¥­', image: 'https://images.unsplash.com/photo-1586190848861-99aa4a171e90?w=200&h=200&fit=crop&crop=center', rarity: 'common' },
            { name: 'ä¾¿å½“', image: 'https://images.unsplash.com/photo-1575444758702-4a6b9222336e?w=200&h=200&fit=crop&crop=center', rarity: 'common' },

            // ç´«è‰² - å°‘è§ (30%)
            { name: 'å…°å·æ‹‰é¢', image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'é»„ç„–é¸¡ç±³é¥­', image: 'https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'é‡åº†å°é¢', image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'ç…²ä»”é¥­', image: 'https://images.unsplash.com/photo-1512058564366-18510be2db19?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'ç±³çº¿', image: 'https://images.unsplash.com/photo-1585032226651-759b368d7246?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'ç‚¸é¸¡', image: 'https://images.unsplash.com/photo-1562967916-eb82221dfb92?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'æ±‰å ¡', image: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'æŠ«è¨', image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },
            { name: 'ç”œå“', image: 'https://images.unsplash.com/photo-1551024506-0bccd828d307?w=200&h=200&fit=crop&crop=center', rarity: 'uncommon' },

            // ç²‰è‰² - ç¨€æœ‰ (15%)
            { name: 'å·èœ', image: 'https://images.unsplash.com/photo-1526318896980-cf78c088247c?w=200&h=200&fit=crop&crop=center', rarity: 'rare' },
            { name: 'ç²¤èœ', image: 'https://images.unsplash.com/photo-1563379091339-03246963d96c?w=200&h=200&fit=crop&crop=center', rarity: 'rare' },
            { name: 'æ¹˜èœ', image: 'https://images.unsplash.com/photo-1582878826629-29b7ad1cdc43?w=200&h=200&fit=crop&crop=center', rarity: 'rare' },
            { name: 'ä¸œåŒ—èœ', image: 'https://images.unsplash.com/photo-1565299507177-b0ac66763828?w=200&h=200&fit=crop&crop=center', rarity: 'rare' },
            { name: 'æ„å¤§åˆ©é¢', image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=200&h=200&fit=crop&crop=center', rarity: 'rare' },

            // æ©™è‰² - å²è¯— (4%)
            { name: 'æ—¥å¼æ–™ç†', image: 'https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=200&h=200&fit=crop&crop=center', rarity: 'epic' },
            { name: 'éŸ©å¼æ–™ç†', image: 'https://images.unsplash.com/photo-1590301157890-4810ed352733?w=200&h=200&fit=crop&crop=center', rarity: 'epic' },
            { name: 'å¯¿å¸', image: 'https://images.unsplash.com/photo-1553621042-f6e147245754?w=200&h=200&fit=crop&crop=center', rarity: 'epic' },
            { name: 'çƒ¤è‚‰', image: 'https://images.unsplash.com/photo-1558030006-450675393462?w=200&h=200&fit=crop&crop=center', rarity: 'epic' },
            { name: 'ç«é”…', image: 'https://images.unsplash.com/photo-1582878826629-29b7ad1cdc43?w=200&h=200&fit=crop&crop=center', rarity: 'epic' },
            { name: 'å°é¾™è™¾', image: 'https://images.unsplash.com/photo-1565299507177-b0ac66763828?w=200&h=200&fit=crop&crop=center', rarity: 'epic' },
            { name: 'çƒ§çƒ¤', image: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=200&h=200&fit=crop&crop=center', rarity: 'epic' },

            // é‡‘è‰² - ä¼ å¥‡ (1%)
            { name: 'åƒå¤§ä»½å»å§! ğŸ’©', image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRkZEODAwIiByeD0iMjAiLz4KPHN2ZyB4PSI1MCIgeT0iNTAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IiM4QjQ1MTMiPgo8cGF0aCBkPSJNMTIgMkwyLjUgMTBsMy43IDQuM0w4IDIwaDh2LTVsMS44LTUuN0wyMS41IDEwTDEyIDJ6bTAgMy4yTDE4IDEwSDZ6bTAgMTEuOGgtM2wtMS0yaDEwbC0xIDJ6Ii8+Cjwvc3ZnPgo8L3N2Zz4K', rarity: 'legendary' }
        ];

        let currentMode = 'wheel'; // wheel æˆ– box
        let currentRotation = 0;
        let isSpinning = false;

        function formatNumber(num) { if (num > 1000) return num.toFixed(2); if (num > 1) return num.toFixed(4); return num.toFixed(6); }
        function showNotification() { if (notificationTimeout) clearTimeout(notificationTimeout); notificationEl.classList.add('show'); notificationTimeout = setTimeout(() => notificationEl.classList.remove('show'), 2000); }

        // æƒé‡æŠ½å–å‡½æ•°
        function getRandomFood() {
            const rand = Math.random() * 100;

            // 1% æ¦‚ç‡é‡‘è‰²ä¼ å¥‡
            if (rand <= 1) {
                return foodData.find(food => food.rarity === 'legendary');
            }
            // 4% æ¦‚ç‡æ©™è‰²å²è¯—
            else if (rand <= 5) {
                const epicFoods = foodData.filter(food => food.rarity === 'epic');
                return epicFoods[Math.floor(Math.random() * epicFoods.length)];
            }
            // 15% æ¦‚ç‡ç²‰è‰²ç¨€æœ‰
            else if (rand <= 20) {
                const rareFoods = foodData.filter(food => food.rarity === 'rare');
                return rareFoods[Math.floor(Math.random() * rareFoods.length)];
            }
            // 30% æ¦‚ç‡ç´«è‰²å°‘è§
            else if (rand <= 50) {
                const uncommonFoods = foodData.filter(food => food.rarity === 'uncommon');
                return uncommonFoods[Math.floor(Math.random() * uncommonFoods.length)];
            }
            // 50% æ¦‚ç‡è“è‰²æ™®é€š
            else {
                const commonFoods = foodData.filter(food => food.rarity === 'common');
                return commonFoods[Math.floor(Math.random() * commonFoods.length)];
            }
        }

        // æ¨¡å¼åˆ‡æ¢å‡½æ•°
        function toggleMode() {
            const wheelMode = document.getElementById('wheel-mode');
            const boxMode = document.getElementById('box-mode');

            if (currentMode === 'wheel') {
                currentMode = 'box';
                wheelMode.style.display = 'none';
                boxMode.style.display = 'flex';
                setupBoxMode();
            } else {
                currentMode = 'wheel';
                wheelMode.style.display = 'flex';
                boxMode.style.display = 'none';
                drawWheel();
            }
        }

        // è®¾ç½®å¼€ç®±æ¨¡å¼ - é‡ç½®åˆ°ç›²ç›’çŠ¶æ€
        function setupBoxMode() {
            const mysteryBox = document.getElementById('mystery-box');
            const boxViewer = document.getElementById('box-viewer');
            const boxButton = document.getElementById('box-button');

            // æ˜¾ç¤ºç›²ç›’ï¼Œéšè—å¼€ç®±å™¨
            mysteryBox.style.display = 'flex';
            boxViewer.classList.remove('active');
            boxButton.style.display = 'none';

            // é‡ç½®å¼€ç®±å™¨çŠ¶æ€
            const boxTrack = document.getElementById('box-track');
            boxTrack.innerHTML = '';
            boxTrack.style.transform = 'translateX(0)';
            boxTrack.style.transition = 'none';
        }

        // ç”Ÿæˆå¼€ç®±è½¨é“
        function generateBoxTrack(finalFood) {
            const boxTrack = document.getElementById('box-track');
            boxTrack.innerHTML = '';

            // ç”Ÿæˆè¶³å¤Ÿçš„éšæœºé£Ÿç‰©é¡¹ (ç”¨äºæ»‘åŠ¨æ•ˆæœ)
            const items = [];
            for (let i = 0; i < 50; i++) {
                if (i === 25) {
                    items.push(finalFood); // ä¸­é—´ä½ç½®æ”¾ç½®è·èƒœé£Ÿç‰©
                } else {
                    items.push(getRandomFood());
                }
            }

            items.forEach(food => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `box-item rarity-${food.rarity}`;
                itemDiv.innerHTML = `
                    <img src="${food.image}" alt="${food.name}">
                    <div class="item-name">${food.name}</div>
                `;
                boxTrack.appendChild(itemDiv);
            });
        }

        // å¼€ç®±åŠ¨ç”» - ä»ç›²ç›’å¼€å§‹
        function startBoxSpin() {
            if (isSpinning) return;

            const mysteryBox = document.getElementById('mystery-box');
            const boxViewer = document.getElementById('box-viewer');
            const boxTrack = document.getElementById('box-track');

            isSpinning = true;


            // ç¬¬ä¸€é˜¶æ®µï¼šç›²ç›’éœ‡åŠ¨åŠ¨ç”»
            mysteryBox.classList.add('opening');

            setTimeout(() => {
                // ç¬¬äºŒé˜¶æ®µï¼šè¿‡æ¸¡åˆ°å¼€ç®±å™¨
                mysteryBox.style.display = 'none';
                boxViewer.style.display = 'block';

                // é¢„æŠ½å–æœ€ç»ˆç»“æœ
                const finalFood = getRandomFood();

                generateBoxTrack(finalFood);

                // æ¿€æ´»å¼€ç®±å™¨
                setTimeout(() => {
                    boxViewer.classList.add('active');

                    // ç¬¬ä¸‰é˜¶æ®µï¼šå¼€å§‹æ»‘åŠ¨åŠ¨ç”»
                    setTimeout(() => {

                        // è®¡ç®—æ»‘åŠ¨è·ç¦»
                        const itemWidth = 140; // 120px width + 20px margin
                        const containerWidth = boxViewer.clientWidth;
                        const centerOffset = containerWidth / 2;
                        const targetPosition = -(25 * itemWidth) + centerOffset - (itemWidth / 2);

                        // å¼ºåˆ¶ç§»é™¤ä»»ä½•ç°æœ‰åŠ¨ç”»
                        boxTrack.style.transition = '';
                        boxTrack.style.animation = '';
                        boxTrack.style.transform = 'translateX(0px)';

                        // ä½¿ç”¨JavaScriptåŠ¨ç”»ä»£æ›¿CSS transition
                        let startTime = null;
                        const duration = 3000; // 3ç§’
                        const startPosition = 0;

                        function animateSlide(timestamp) {
                            if (!startTime) startTime = timestamp;
                            const progress = Math.min((timestamp - startTime) / duration, 1);

                            // ä½¿ç”¨easingå‡½æ•°
                            const easeProgress = 1 - Math.pow(1 - progress, 3);
                            const currentPosition = startPosition + (targetPosition * easeProgress);

                            boxTrack.style.transform = `translateX(${currentPosition}px)`;

                            if (progress < 1) {
                                requestAnimationFrame(animateSlide);
                            } else {
                                // åŠ¨ç”»å®Œæˆ
                                showResult(finalFood);
                                isSpinning = false;
                                mysteryBox.classList.remove('opening');

                                // 2ç§’åé‡ç½®åˆ°ç›²ç›’çŠ¶æ€
                                setTimeout(() => {
                                    setupBoxMode();
                                }, 2000);
                            }
                        }

                        requestAnimationFrame(animateSlide);
                    }, 300);
                }, 100);
            }, 500);
        }
        
        function renderCurrencyRows() {
            ratesContainer.innerHTML = ''; 
            currencyOrder.forEach(code => { 
                const name = currencyNames[code]; 
                if (!name) return; 
                const rateRow = document.createElement('div'); 
                rateRow.className = 'rate-row'; 
                rateRow.dataset.currencyCode = code; 
                const flagUrl = getFlagUrl(code);
                rateRow.innerHTML = `<span class="drag-handle" title="æ‹–åŠ¨æ’åº"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM4 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM4 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm5 10a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM9 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm5 10a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM14 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm0-5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg></span><span class="currency-flag" data-flag-url="${flagUrl}" title="${code}æ——å¸œ"></span><span class="currency-code">${code}</span><span class="separator">|</span><input type="text" class="currency-value" data-currency="${code}" placeholder="0.00"><span class="currency-name">${name}</span>`;

                // è®¾ç½®æ——å¸œèƒŒæ™¯å¹¶å¤„ç†åŠ è½½å¤±è´¥
                const flagElement = rateRow.querySelector('.currency-flag');
                const img = new Image();
                img.onload = () => {
                    flagElement.style.backgroundImage = `url('${flagUrl}')`;
                };
                img.onerror = () => {
                    flagElement.classList.add('error');
                };
                img.src = flagUrl; 
                ratesContainer.appendChild(rateRow); 
            }); 
            addInputEventListeners();
        }

        function addInputEventListeners() { 
            document.querySelectorAll('.currency-value').forEach(input => { 
                input.addEventListener('input', handleInputChange); 
                input.addEventListener('click', handleInputClick);
                input.addEventListener('keydown', handleInputKeydown);
            }); 
        }

        function handleInputClick(event) { 
            const value = event.target.value; 
            if (value && !isNaN(value)) {
                navigator.clipboard.writeText(value).then(showNotification).catch(err => console.error('å¤åˆ¶å¤±è´¥:', err)); 
            }
        }

        function handleInputChange(event) {
            const input = event.target;
            const value = parseFloat(input.value);
            if (!isNaN(value)) {
                baseCurrencyForCalc = input.dataset.currency; 
                baseAmountForCalc = value;
                updateAllValues();
            }
        }

        function handleInputKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const expression = input.value;
                try {
                    const result = new Function('return ' + expression.replace(/[^0-9\.\+\-\*\/]/g, ''))();
                    if (typeof result === 'number' && isFinite(result)) {
                        input.value = result;
                        input.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                } catch (e) {
                    console.error("è®¡ç®—é”™è¯¯:", e);
                }
            }
        }
        
        async function fetchRates() {
            refreshButton.disabled = true;
            updateTimeEl.textContent = 'æ­£åœ¨åˆ·æ–°æ±‡ç‡æ•°æ®...';
            try {
                const response = await fetch('/api/rates');
                if (!response.ok) throw new Error(`æœåŠ¡å™¨é”™è¯¯: ${response.statusText}`);
                const data = await response.json();
                if (data.result === 'success') {
                    exchangeRates = data.conversion_rates;
                    const apiLastUpdated = new Date(data.time_last_update_unix * 1000).toLocaleString('zh-CN');
                    const localRefreshTime = new Date().toLocaleString('zh-CN');
                    updateTimeEl.innerHTML = `æ•°æ®æ›´æ–°æ—¶é—´: <strong>${apiLastUpdated}</strong><br>åˆ·æ–°æ—¶é—´: <strong>${localRefreshTime}</strong>`;
                    updateAllValues();
                } else {
                    throw new Error(data['error-type'] || 'è·å–æ±‡ç‡å¤±è´¥');
                }
            } catch (error) {
                console.error('è·å–æ±‡ç‡é”™è¯¯:', error);
                updateTimeEl.textContent = `è·å–æ±‡ç‡å¤±è´¥: ${error.message}ï¼Œè¯·ç¨åé‡è¯•ã€‚`;
            } finally {
                refreshButton.disabled = false;
            }
        }
        
        function updateAllValues() { 
            if (Object.keys(exchangeRates).length === 0) return; 
            const baseValueInCNY = baseAmountForCalc / (exchangeRates[baseCurrencyForCalc] || 1); 
            document.querySelectorAll('.currency-value').forEach(input => { 
                const currencyCode = input.dataset.currency; 
                if (currencyCode === baseCurrencyForCalc) { 
                    if (document.activeElement !== input) { 
                        input.value = formatNumber(baseAmountForCalc); 
                    }
                    return; 
                } 
                if (exchangeRates[currencyCode]) { input.value = formatNumber(baseValueInCNY * exchangeRates[currencyCode]); } 
            }); 
        }
        
        function initSortable() {
            new Sortable(ratesContainer, {
                animation: 200,
                handle: '.drag-handle',
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                onEnd: function (evt) {
                    const movedItem = currencyOrder.splice(evt.oldIndex, 1)[0];
                    currencyOrder.splice(evt.newIndex, 0, movedItem);
                },
            });
        }

        function switchPage(pageToShow) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(n => n.classList.remove('active'));
            const instructions = document.getElementById('currency-instructions');
            if (pageToShow === 'currency') {
                pageCurrency.classList.add('active');
                navCurrency.classList.add('active');
                instructions.style.display = 'block';
            } else if (pageToShow === 'json') {
                pageJson.classList.add('active');
                navJson.classList.add('active');
                instructions.style.display = 'none';
            } else if (pageToShow === 'food') {
                pageFood.classList.add('active');
                navFood.classList.add('active');
                instructions.style.display = 'none';
                drawWheel(); // åˆ‡æ¢åˆ°è½¬ç›˜é¡µé¢æ—¶é‡ç»˜è½¬ç›˜
            } else if (pageToShow === 'testfile') {
                pageTestfile.classList.add('active');
                navTestfile.classList.add('active');
                instructions.style.display = 'none';
            }
        }

        // æµ‹è¯•æ–‡ä»¶ç”ŸæˆåŠŸèƒ½
        function convertToBytes(size, unit) {
            const units = {
                'B': 1,
                'KB': 1024,
                'MB': 1024 * 1024,
                'GB': 1024 * 1024 * 1024
            };
            return size * (units[unit] || 1);
        }

        async function generateTestFile() {
            const size = parseFloat(fileSizeInput.value);
            const unit = sizeUnitSelect.value;
            let extension = fileExtensionInput.value.trim() || 'test';

            // éªŒè¯è¾“å…¥
            if (!size || size <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ–‡ä»¶å¤§å°');
                return;
            }

            const bytes = convertToBytes(size, unit);
            const maxBytes = 1024 * 1024 * 1024; // 1GB

            if (bytes > maxBytes) {
                alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 1GBï¼ˆå—æµè§ˆå™¨å†…å­˜é™åˆ¶ï¼‰');
                return;
            }

            // ç¡®ä¿æ‰©å±•åä¸åŒ…å«ç‚¹å·
            extension = extension.replace(/^\./, '');

            // æ˜¾ç¤ºè¿›åº¦æ¡
            progressSection.style.display = 'flex';
            progressFill.style.width = '0%';
            generateBtn.disabled = true;
            generateBtn.textContent = 'ç”Ÿæˆä¸­...';

            try {
                // ç”Ÿæˆéšæœºæ•°æ®
                const totalBytes = bytes;
                const chunkSize = 1024 * 1024; // 1MB chunks
                const totalChunks = Math.ceil(totalBytes / chunkSize);
                const chunks = [];

                for (let i = 0; i < totalChunks; i++) {
                    const currentChunkSize = Math.min(chunkSize, totalBytes - i * chunkSize);
                    const chunk = new Uint8Array(currentChunkSize);

                    // å¡«å……éšæœºå­—èŠ‚
                    for (let j = 0; j < currentChunkSize; j++) {
                        chunk[j] = Math.floor(Math.random() * 256);
                    }

                    chunks.push(chunk);

                    // æ›´æ–°è¿›åº¦
                    const progress = ((i + 1) / totalChunks) * 100;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = `ç”Ÿæˆä¸­... ${Math.round(progress)}%`;

                    // è®©æµè§ˆå™¨æœ‰æœºä¼šæ›´æ–°UI
                    if (i % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 0));
                    }
                }

                // åˆ›å»ºBlob
                progressText.textContent = 'å‡†å¤‡ä¸‹è½½...';
                const blob = new Blob(chunks, { type: 'application/octet-stream' });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${size}${unit}.${extension}`;
                document.body.appendChild(a);
                a.click();

                // æ¸…ç†
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                progressText.textContent = 'âœ… ç”Ÿæˆå®Œæˆï¼æ–‡ä»¶å·²å¼€å§‹ä¸‹è½½';
                setTimeout(() => {
                    progressSection.style.display = 'none';
                }, 2000);

            } catch (error) {
                console.error('ç”Ÿæˆæ–‡ä»¶é”™è¯¯:', error);
                alert('ç”Ÿæˆæ–‡ä»¶æ—¶å‡ºç°é”™è¯¯ï¼š' + error.message);
                progressSection.style.display = 'none';
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    ç”Ÿæˆå¹¶ä¸‹è½½æ–‡ä»¶
                `;
            }
        }

        // è½¬ç›˜ç»˜åˆ¶å‡½æ•°
        function drawWheel() {
            if (!wheelCanvas) return;

            const ctx = wheelCanvas.getContext('2d');
            const centerX = wheelCanvas.width / 2;
            const centerY = wheelCanvas.height / 2;
            const radius = Math.min(centerX, centerY) - 10;
            const totalFoods = foodData.length;
            const anglePerSection = (2 * Math.PI) / totalFoods;

            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);

            // ç”Ÿæˆé¢œè‰²æ•°ç»„
            const colors = [
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD',
                '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA',
                '#F1948A', '#85C1E9', '#F8C471', '#82E0AA', '#F1948A', '#85C1E9',
                '#F8C471', '#82E0AA', '#F1948A', '#85C1E9', '#F8C471', '#82E0AA',
                '#F1948A', '#85C1E9', '#F8C471', '#82E0AA', '#F1948A', '#85C1E9',
                '#F8C471', '#82E0AA', '#F1948A', '#85C1E9', '#F8C471', '#82E0AA'
            ];

            let imagesLoaded = 0;
            const totalImages = totalFoods;

            // ç»˜åˆ¶æ‰‡å½¢å’ŒåŠ è½½å›¾ç‰‡
            for (let i = 0; i < totalFoods; i++) {
                const startAngle = i * anglePerSection - Math.PI / 2;
                const endAngle = (i + 1) * anglePerSection - Math.PI / 2;

                // ç»˜åˆ¶æ‰‡å½¢èƒŒæ™¯
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // ç»˜åˆ¶é£Ÿç‰©å›¾ç‰‡ - å¸¦å¤‡ç”¨æ–¹æ¡ˆ
                const img = new Image();
                img.crossOrigin = 'anonymous';

                const drawImageContent = (useImage = true) => {
                    const imageAngle = startAngle + anglePerSection / 2;
                    const imageRadius = radius * 0.7;
                    const imageX = centerX + Math.cos(imageAngle) * imageRadius;
                    const imageY = centerY + Math.sin(imageAngle) * imageRadius;
                    const imageSize = 30;

                    ctx.save();
                    ctx.translate(imageX, imageY);
                    ctx.rotate(imageAngle + Math.PI / 2);

                    if (useImage) {
                        // ç»˜åˆ¶åœ†å½¢å›¾ç‰‡
                        ctx.beginPath();
                        ctx.arc(0, 0, imageSize / 2, 0, 2 * Math.PI);
                        ctx.clip();
                        ctx.drawImage(img, -imageSize / 2, -imageSize / 2, imageSize, imageSize);
                        ctx.restore();

                        // ç»˜åˆ¶ç™½è‰²è¾¹æ¡†
                        ctx.beginPath();
                        ctx.arc(imageX, imageY, imageSize / 2, 0, 2 * Math.PI);
                        ctx.strokeStyle = '#fff';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    } else {
                        // å¤‡ç”¨ï¼šç»˜åˆ¶é£Ÿç‰©emoji
                        const foodEmojis = {
                            'åŒ…å­': 'ğŸ¥Ÿ', 'é¥ºå­': 'ğŸ¥Ÿ', 'é¢æ¡': 'ğŸœ', 'é¦„é¥¨': 'ğŸ¥Ÿ', 'ç²¥ç±»': 'ğŸ²',
                            'ç‚’é¥­': 'ğŸ›', 'è›‹ç‚’é¥­': 'ğŸ›', 'ä¸‰æ˜æ²»': 'ğŸ¥ª', 'è½»é£Ÿæ²™æ‹‰': 'ğŸ¥—', 'å¥¶èŒ¶': 'ğŸ§‹',
                            'éº»è¾£çƒ«': 'ğŸ²', 'æ²™å¿å°åƒ': 'ğŸœ', 'ç›–æµ‡é¥­': 'ğŸ›', 'å’–å–±é¥­': 'ğŸ›', 'ä¾¿å½“': 'ğŸ±',
                            'å…°å·æ‹‰é¢': 'ğŸœ', 'é»„ç„–é¸¡ç±³é¥­': 'ğŸ›', 'é‡åº†å°é¢': 'ğŸœ', 'ç…²ä»”é¥­': 'ğŸ›', 'ç±³çº¿': 'ğŸœ',
                            'ç‚¸é¸¡': 'ğŸ—', 'æ±‰å ¡': 'ğŸ”', 'æŠ«è¨': 'ğŸ•', 'ç”œå“': 'ğŸ°',
                            'å·èœ': 'ğŸŒ¶ï¸', 'ç²¤èœ': 'ğŸ¦', 'æ¹˜èœ': 'ğŸŒ¶ï¸', 'ä¸œåŒ—èœ': 'ğŸ¥˜', 'æ„å¤§åˆ©é¢': 'ğŸ',
                            'æ—¥å¼æ–™ç†': 'ğŸ£', 'éŸ©å¼æ–™ç†': 'ğŸ–', 'å¯¿å¸': 'ğŸ£', 'çƒ¤è‚‰': 'ğŸ–', 'ç«é”…': 'ğŸ²',
                            'å°é¾™è™¾': 'ğŸ¦', 'çƒ§çƒ¤': 'ğŸ–'
                        };

                        ctx.fillStyle = '#333';
                        ctx.font = 'bold 20px system-ui, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(foodEmojis[foodData[i].name] || 'ğŸ½ï¸', 0, 0);
                        ctx.restore();
                    }
                };

                img.onload = () => {
                    imagesLoaded++;
                    drawImageContent(true);
                };

                img.onerror = () => {
                    imagesLoaded++;
                    drawImageContent(false);
                };

                img.src = foodData[i].image;
            }

            // ç»˜åˆ¶ä¸­å¿ƒåœ†
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, 2 * Math.PI);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.stroke();

            // ç»˜åˆ¶ä¸­å¿ƒæ–‡å­—
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px system-ui, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ğŸ½ï¸', centerX, centerY);
        }

        // è½¬ç›˜æ—‹è½¬å‡½æ•°
        function spinWheel() {
            if (isSpinning) return;

            isSpinning = true;
            spinButton.disabled = true;
            spinButton.textContent = 'è½¬ç›˜ä¸­...';

            // ä½¿ç”¨æƒé‡æŠ½å–é€‰æ‹©é£Ÿç‰©
            const selectedFood = getRandomFood();
            const randomIndex = foodData.findIndex(food => food.name === selectedFood.name);

            const anglePerSection = 360 / foodData.length;
            const targetAngle = 360 - (randomIndex * anglePerSection + anglePerSection / 2);

            // æ·»åŠ å¤šåœˆæ—‹è½¬
            const extraRotations = 5 + Math.random() * 3; // 5-8åœˆ
            const totalRotation = extraRotations * 360 + targetAngle;
            const finalAngle = currentRotation + totalRotation;


            // å¼ºåˆ¶ç§»é™¤ä»»ä½•ç°æœ‰åŠ¨ç”»
            wheelCanvas.style.transition = '';
            wheelCanvas.style.animation = '';

            // ä½¿ç”¨æ›´å¯é çš„åŠ¨ç”»æ–¹æ³•
            let startTime = null;
            const duration = 4000; // 4ç§’
            const startAngle = currentRotation;

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);

                // ä½¿ç”¨easingå‡½æ•°
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                const currentAngle = startAngle + (totalRotation * easeProgress);

                wheelCanvas.style.transform = `rotate(${currentAngle}deg)`;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // åŠ¨ç”»å®Œæˆ
                    currentRotation = finalAngle % 360;
                    showResult(selectedFood);
                    isSpinning = false;
                    spinButton.disabled = false;
                    spinButton.textContent = 'å¼€å§‹è½¬ç›˜';
                }
            }

            requestAnimationFrame(animate);
        }

        // æ˜¾ç¤ºç»“æœå¼¹çª—
        function showResult(food) {
            resultImage.src = food.image;
            resultImage.alt = food.name;
            resultName.textContent = food.name;

            // æ·»åŠ ç¨€æœ‰åº¦ä¿¡æ¯
            const resultContent = document.querySelector('.result-content');
            let rarityText = '';
            let rarityColor = '';

            switch (food.rarity) {
                case 'common':
                    rarityText = 'æ™®é€š';
                    rarityColor = '#5dade2';
                    break;
                case 'uncommon':
                    rarityText = 'å°‘è§';
                    rarityColor = '#bb8fce';
                    break;
                case 'rare':
                    rarityText = 'ç¨€æœ‰';
                    rarityColor = '#f1948a';
                    break;
                case 'epic':
                    rarityText = 'å²è¯—';
                    rarityColor = '#f8c471';
                    break;
                case 'legendary':
                    rarityText = 'ä¼ å¥‡';
                    rarityColor = '#f39c12';
                    break;
            }

            // ç§»é™¤ä¹‹å‰çš„ç¨€æœ‰åº¦æ ‡ç­¾
            const existingRarity = resultContent.querySelector('.rarity-badge');
            if (existingRarity) {
                existingRarity.remove();
            }

            // æ·»åŠ æ–°çš„ç¨€æœ‰åº¦æ ‡ç­¾
            const rarityBadge = document.createElement('div');
            rarityBadge.className = 'rarity-badge';
            rarityBadge.style.cssText = `
                background: ${rarityColor};
                color: #fff;
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-size: 0.8rem;
                font-weight: 600;
                margin: 0.5rem 0;
                display: inline-block;
            `;
            rarityBadge.textContent = rarityText;

            // åœ¨æ ‡é¢˜åæ’å…¥ç¨€æœ‰åº¦æ ‡ç­¾
            const nameElement = resultContent.querySelector('h2');
            nameElement.parentNode.insertBefore(rarityBadge, nameElement.nextSibling);

            resultModal.classList.add('show');
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            resultModal.classList.remove('show');
        }

        function formatJson() {
            const rawJson = jsonInput.value.trim();
            jsonOutput.classList.remove('error');
            if (!rawJson) {
                jsonOutput.innerHTML = '';
                return;
            }
            try {
                const parsed = JSON.parse(rawJson);
                jsonOutput.innerHTML = '';
                const treeNode = createJsonTree(parsed, 0);
                jsonOutput.appendChild(treeNode);
            } catch (e) {
                jsonOutput.textContent = `JSON æ ¼å¼é”™è¯¯:\n${e.message}`;
                jsonOutput.classList.add('error');
            }
        }

        function createJsonTree(value, depth = 0, key = null) {
            const container = document.createElement('div');
            container.className = 'json-node';

            if (value === null) {
                container.innerHTML = `${key ? `<span class="json-key">"${key}"</span>: ` : ''}<span class="json-null">null</span>`;
            } else if (typeof value === 'boolean') {
                container.innerHTML = `${key ? `<span class="json-key">"${key}"</span>: ` : ''}<span class="json-boolean">${value}</span>`;
            } else if (typeof value === 'number') {
                container.innerHTML = `${key ? `<span class="json-key">"${key}"</span>: ` : ''}<span class="json-number">${value}</span>`;
            } else if (typeof value === 'string') {
                container.innerHTML = `${key ? `<span class="json-key">"${key}"</span>: ` : ''}<span class="json-string">"${escapeHtml(value)}"</span>`;
            } else if (Array.isArray(value)) {
                const isArray = true;
                const length = value.length;
                const levelClass = `level-${depth % 6}`;

                const toggleBtn = document.createElement('span');
                toggleBtn.className = length === 0 ? 'json-toggle empty' : 'json-toggle';
                toggleBtn.textContent = 'â–¼';

                const openBracket = document.createElement('span');
                openBracket.className = `json-bracket ${levelClass}`;
                openBracket.textContent = '[';

                const closeBracket = document.createElement('span');
                closeBracket.className = `json-bracket ${levelClass}`;
                closeBracket.textContent = ']';

                const count = document.createElement('span');
                count.className = 'json-count';
                count.textContent = `${length} ${length === 1 ? 'item' : 'items'}`;

                const content = document.createElement('div');
                content.className = 'json-content';

                const header = document.createElement('div');
                header.appendChild(toggleBtn);
                if (key) {
                    const keySpan = document.createElement('span');
                    keySpan.className = 'json-key';
                    keySpan.textContent = `"${key}": `;
                    header.appendChild(keySpan);
                }
                header.appendChild(openBracket);
                header.appendChild(count);

                container.appendChild(header);

                if (length > 0) {
                    value.forEach((item, index) => {
                        const itemNode = createJsonTree(item, depth + 1);
                        itemNode.style.marginLeft = '20px';
                        if (index < length - 1) {
                            itemNode.innerHTML += ',';
                        }
                        content.appendChild(itemNode);
                    });

                    const closeBracketDiv = document.createElement('div');
                    closeBracketDiv.appendChild(closeBracket);
                    content.appendChild(closeBracketDiv);

                    container.appendChild(content);

                    toggleBtn.addEventListener('click', () => {
                        const isCollapsed = content.style.display === 'none';
                        content.style.display = isCollapsed ? 'block' : 'none';
                        toggleBtn.textContent = isCollapsed ? 'â–¼' : 'â–¶';
                        toggleBtn.classList.toggle('collapsed', !isCollapsed);

                        if (!isCollapsed) {
                            const ellipsis = document.createElement('span');
                            ellipsis.className = 'json-ellipsis';
                            ellipsis.textContent = ` ... `;
                            ellipsis.addEventListener('click', () => {
                                content.style.display = 'block';
                                toggleBtn.textContent = 'â–¼';
                                toggleBtn.classList.remove('collapsed');
                                ellipsis.remove();
                            });
                            header.appendChild(ellipsis);
                        } else {
                            const ellipsis = header.querySelector('.json-ellipsis');
                            if (ellipsis) ellipsis.remove();
                        }

                        if (!isCollapsed) {
                            header.appendChild(closeBracket);
                        } else {
                            const inlineCloseBracket = header.querySelector('.json-bracket:last-child');
                            if (inlineCloseBracket && inlineCloseBracket !== openBracket) {
                                inlineCloseBracket.remove();
                            }
                        }
                    });
                } else {
                    const inlineClose = document.createElement('span');
                    inlineClose.className = `json-bracket ${levelClass}`;
                    inlineClose.textContent = ']';
                    header.appendChild(inlineClose);
                }

            } else if (typeof value === 'object') {
                const keys = Object.keys(value);
                const length = keys.length;
                const levelClass = `level-${depth % 6}`;

                const toggleBtn = document.createElement('span');
                toggleBtn.className = length === 0 ? 'json-toggle empty' : 'json-toggle';
                toggleBtn.textContent = 'â–¼';

                const openBracket = document.createElement('span');
                openBracket.className = `json-bracket ${levelClass}`;
                openBracket.textContent = '{';

                const closeBracket = document.createElement('span');
                closeBracket.className = `json-bracket ${levelClass}`;
                closeBracket.textContent = '}';

                const count = document.createElement('span');
                count.className = 'json-count';
                count.textContent = `${length} ${length === 1 ? 'property' : 'properties'}`;

                const content = document.createElement('div');
                content.className = 'json-content';

                const header = document.createElement('div');
                header.appendChild(toggleBtn);
                if (key) {
                    const keySpan = document.createElement('span');
                    keySpan.className = 'json-key';
                    keySpan.textContent = `"${key}": `;
                    header.appendChild(keySpan);
                }
                header.appendChild(openBracket);
                header.appendChild(count);

                container.appendChild(header);

                if (length > 0) {
                    keys.forEach((objKey, index) => {
                        const itemNode = createJsonTree(value[objKey], depth + 1, objKey);
                        itemNode.style.marginLeft = '20px';
                        if (index < length - 1) {
                            itemNode.innerHTML += ',';
                        }
                        content.appendChild(itemNode);
                    });

                    const closeBracketDiv = document.createElement('div');
                    closeBracketDiv.appendChild(closeBracket);
                    content.appendChild(closeBracketDiv);

                    container.appendChild(content);

                    toggleBtn.addEventListener('click', () => {
                        const isCollapsed = content.style.display === 'none';
                        content.style.display = isCollapsed ? 'block' : 'none';
                        toggleBtn.textContent = isCollapsed ? 'â–¼' : 'â–¶';
                        toggleBtn.classList.toggle('collapsed', !isCollapsed);

                        if (!isCollapsed) {
                            const ellipsis = document.createElement('span');
                            ellipsis.className = 'json-ellipsis';
                            ellipsis.textContent = ` ... `;
                            ellipsis.addEventListener('click', () => {
                                content.style.display = 'block';
                                toggleBtn.textContent = 'â–¼';
                                toggleBtn.classList.remove('collapsed');
                                ellipsis.remove();
                            });
                            header.appendChild(ellipsis);
                        } else {
                            const ellipsis = header.querySelector('.json-ellipsis');
                            if (ellipsis) ellipsis.remove();
                        }

                        if (!isCollapsed) {
                            header.appendChild(closeBracket);
                        } else {
                            const inlineCloseBracket = header.querySelector('.json-bracket:last-child');
                            if (inlineCloseBracket && inlineCloseBracket !== openBracket) {
                                inlineCloseBracket.remove();
                            }
                        }
                    });
                } else {
                    const inlineClose = document.createElement('span');
                    inlineClose.className = `json-bracket ${levelClass}`;
                    inlineClose.textContent = '}';
                    header.appendChild(inlineClose);
                }
            }

            return container;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ä¸»é¢˜ç®¡ç†
        const themeManager = {
            current: 'system',

            init() {
                // è·å–ä¿å­˜çš„ä¸»é¢˜è®¾ç½®
                this.current = localStorage.getItem('theme') || 'system';
                this.apply();
                this.bindEvents();
                this.updateButtons();

                // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                    if (this.current === 'system') {
                        this.apply();
                    }
                });
            },

            apply() {
                const root = document.documentElement;

                if (this.current === 'dark') {
                    root.setAttribute('data-theme', 'dark');
                } else if (this.current === 'light') {
                    root.removeAttribute('data-theme');
                } else { // system
                    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (isDark) {
                        root.setAttribute('data-theme', 'dark');
                    } else {
                        root.removeAttribute('data-theme');
                    }
                }
            },

            set(theme) {
                this.current = theme;
                localStorage.setItem('theme', theme);
                this.apply();
                this.updateButtons();
            },

            updateButtons() {
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`theme-${this.current}`).classList.add('active');
            },

            bindEvents() {
                document.getElementById('theme-light').addEventListener('click', () => this.set('light'));
                document.getElementById('theme-dark').addEventListener('click', () => this.set('dark'));
                document.getElementById('theme-system').addEventListener('click', () => this.set('system'));
            }
        };

        async function init() {
            themeManager.init();
            renderCurrencyRows();
            initSortable();
            await fetchRates();
            baseAmountForCalc = DEFAULT_AMOUNT;
            const baseInput = document.querySelector(`.currency-value[data-currency="${BASE_CURRENCY}"]`);
            if (baseInput) { baseInput.value = DEFAULT_AMOUNT; }
            updateAllValues();
            // é»˜è®¤æ˜¾ç¤ºæ±‡ç‡è¯´æ˜æ¡†
            document.getElementById('currency-instructions').style.display = 'block';
            refreshButton.addEventListener('click', fetchRates);
            navCurrency.addEventListener('click', () => switchPage('currency'));
            navJson.addEventListener('click', () => switchPage('json'));
            navFood.addEventListener('click', () => switchPage('food'));
            navTestfile.addEventListener('click', () => switchPage('testfile'));
            jsonInput.addEventListener('input', formatJson);

            // æµ‹è¯•æ–‡ä»¶ç”Ÿæˆäº‹ä»¶ç›‘å¬å™¨
            generateBtn.addEventListener('click', generateTestFile);
            exampleTags.forEach(tag => {
                tag.addEventListener('click', () => {
                    fileSizeInput.value = tag.dataset.size;
                    sizeUnitSelect.value = tag.dataset.unit;
                });
            });

            // è½¬ç›˜ç›¸å…³äº‹ä»¶ç›‘å¬å™¨
            spinButton.addEventListener('click', spinWheel);
            document.getElementById('mystery-box').addEventListener('click', startBoxSpin);
            document.getElementById('mode-toggle').addEventListener('click', toggleMode);
            closeBtn.addEventListener('click', closeModal);
            resultModal.addEventListener('click', (e) => {
                if (e.target === resultModal) closeModal();
            });

            setInterval(fetchRates, 15 * 60 * 1000);
        }

        init();
    });
</script>
</body>
</html>
